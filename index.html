<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLANNING HEBDOMADAIRE ASTEC-SUD-OUEST - Collaboratif</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .setup-banner { background: #FFF3E0; border: 2px solid #FF9800; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .setup-banner h3 { color: #E65100; margin-bottom: 10px; }
        .setup-banner input, .setup-banner button { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .setup-banner button { background: #4CAF50; color: white; padding: 12px 30px; border: none; cursor: pointer; font-size: 16px; }
        .setup-banner button:hover { background: #45a049; }
        .setup-banner.configured { background: #E8F5E9; border-color: #4CAF50; }
        .setup-banner.configured h3 { color: #2E7D32; }
        .sync-status { position: fixed; top: 20px; right: 20px; padding: 10px 20px; border-radius: 4px; font-weight: bold; z-index: 2000; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .sync-status.online { background: #4CAF50; color: white; }
        .sync-status.offline { background: #f44336; color: white; }
        .sync-status.connecting { background: #FF9800; color: white; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .year-selector { padding: 8px 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 4px; }
        .logo-container { display: flex; align-items: center; gap: 20px; }
        .team-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; transition: all 0.3s; }
        .btn-primary { background: #9C27B0; color: white; }
        .btn-primary:hover { background: #7B1FA2; }
        .btn-atelier { background: #2196F3; color: white; }
        .btn-atelier:hover { background: #1976D2; }
        .btn-success { background: #4CAF50; color: white; }
        .btn-success:hover { background: #45a049; }
        .btn-warning { background: #FF9800; color: white; }
        .btn-warning:hover { background: #F57C00; }
        .btn-print { background: #9C27B0; color: white; }
        .btn-print:hover { background: #7B1FA2; }
        .btn-vacation { background: #A1887F; color: white; }
        .btn-vacation:hover { background: #8D6E63; }
        .btn-danger { background: #f44336; color: white; }
        .btn-danger:hover { background: #d32f2f; }
        .legend { display: flex; gap: 20px; margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 4px; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 8px; }
        .legend-color { width: 30px; height: 20px; border-radius: 3px; border: 1px solid #ddd; }
        .legend-arret { background: repeating-linear-gradient(45deg, #fff9c4, #fff9c4 5px, #f4e896 5px, #f4e896 10px); }
        .legend-atelier { background: #2196F3; }
        .legend-atelier-stagiaire { background: repeating-linear-gradient(45deg, #2196F3, #2196F3 5px, #1976D2 5px, #1976D2 10px); }
        .legend-charge { background: #4CAF50; }
        .legend-charge-stagiaire { background: repeating-linear-gradient(45deg, #4CAF50, #4CAF50 5px, #388E3C 5px, #388E3C 10px); }
        .legend-bureau { background: #FF9800; }
        .legend-bureau-stagiaire { background: repeating-linear-gradient(45deg, #FF9800, #FF9800 5px, #F57C00 5px, #F57C00 10px); }
        .planning-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .planning-table th, .planning-table td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        .planning-table th { background: #9C27B0; color: white; font-weight: bold; }
        .planning-table td.personnel-cell { background: white; font-weight: bold; }
        .personnel-atelier { background: #2196F3 !important; color: white; }
        .personnel-atelier.stagiaire { background: repeating-linear-gradient(45deg, #2196F3, #2196F3 5px, #1976D2 5px, #1976D2 10px) !important; }
        .personnel-chargeaffaire { background: #4CAF50 !important; color: white; }
        .personnel-chargeaffaire.stagiaire { background: repeating-linear-gradient(45deg, #4CAF50, #4CAF50 5px, #388E3C 5px, #388E3C 10px) !important; }
        .personnel-bureau { background: #FF9800 !important; color: white; }
        .personnel-bureau.stagiaire { background: repeating-linear-gradient(45deg, #FF9800, #FF9800 5px, #F57C00 5px, #F57C00 10px) !important; }
        .holiday { background: #ffebee; font-weight: bold; }
        .vacation { background: #fff9c4; font-style: italic; }
        .arret-travail { background: repeating-linear-gradient(45deg, #fff9c4, #fff9c4 5px, #f4e896 5px, #f4e896 10px); font-style: italic; }
        .work-cell { background: #e3f2fd; cursor: pointer; min-height: 60px; vertical-align: top; padding: 5px; font-size: 11px; }
        .work-cell:hover { background: #bbdefb; }
        .work-info { text-align: left; word-wrap: break-word; }
        .work-info strong { display: block; margin-bottom: 2px; }
        .day-select { width: 100%; padding: 5px; border: 1px solid #ddd; border-radius: 4px; background: white; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 50px auto; padding: 30px; width: 90%; max-width: 600px; border-radius: 8px; max-height: 80vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .close { font-size: 28px; font-weight: bold; cursor: pointer; color: #999; }
        .close:hover { color: #333; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .personnel-list { margin-top: 20px; }
        .personnel-item { background: #f9f9f9; padding: 15px; margin-bottom: 10px; border-radius: 4px; border: 1px solid #ddd; }
        .personnel-item h4 { margin-bottom: 10px; color: #2196F3; }
        .personnel-item button { margin-top: 10px; }
        .checkbox-group { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 10px 0; }
        .checkbox-label { display: flex; align-items: center; gap: 5px; }
        .week-navigation { display: flex; gap: 10px; align-items: center; margin: 20px 0; }
        .week-info { font-weight: bold; font-size: 18px; margin: 0 20px; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .week-number { color: #9C27B0; font-size: 14px; }
        .add-personnel-btn { margin-top: 10px; width: 100%; }
        .delete-options { margin-top: 15px; padding: 15px; background: #fff3e0; border-radius: 4px; border: 1px solid #ff9800; }
        .delete-options h4 { margin-bottom: 10px; color: #f57c00; }
        @media print { .setup-banner, .sync-status, .team-buttons, .week-navigation, .btn-print, .no-print { display: none !important; } }
    </style>
</head>
<body>
    <div class="sync-status connecting" id="syncStatus">Configuration requise</div>
    <div class="container">
        <div class="setup-banner" id="setupBanner">
            <h3>‚öôÔ∏è Configuration Firebase (Une seule fois)</h3>
            <p style="margin-bottom: 15px;">Pour activer le mode collaboratif, collez votre configuration Firebase :</p>
            <textarea id="firebaseConfig" rows="8" style="width: 100%; padding: 10px; font-family: monospace; font-size: 12px;"></textarea>
            <button onclick="saveFirebaseConfig()">üíæ Enregistrer et activer</button>
        </div>
        <div class="header">
            <h1>Planning Hebdomadaire Astec-sud-ouest</h1>
            <div class="logo-container">
                <div style="display: flex; gap: 15px; align-items: center;">
                    <div><label for="yearSelect">Ann√©e : </label><select id="yearSelect" class="year-selector"></select></div>
                    <div><label for="weekNumber">Semaine N¬∞ : </label><input type="number" id="weekNumber" class="year-selector" style="width: 80px;" min="1" max="53" onkeypress="if(event.key==='Enter') goToWeek()"><button class="btn btn-primary" onclick="goToWeek()" style="margin-left: 5px; padding: 8px 15px;">Aller</button></div>
                </div>
            </div>
        </div>
        <div class="team-buttons no-print">
            <button class="btn btn-atelier" onclick="openTeamModal('atelier')">Personnel Atelier</button>
            <button class="btn btn-success" onclick="openTeamModal('chargeaffaire')">Personnel Charg√© d'affaire</button>
            <button class="btn btn-warning" onclick="openTeamModal('bureau')">Personnel Bureau</button>
            <button class="btn btn-vacation" onclick="openVacationModal()">Cong√©s Personnel</button>
            <button class="btn btn-print" onclick="printPlanning()">Imprimer</button>
        </div>
        <div class="week-navigation no-print">
            <button class="btn btn-primary" onclick="previousWeek()">‚Üê Semaine pr√©c√©dente</button>
            <span class="week-info" id="weekInfo"></span>
            <button class="btn btn-primary" onclick="nextWeek()">Semaine suivante ‚Üí</button>
        </div>
        <div class="legend">
            <div class="legend-item"><div class="legend-color legend-atelier"></div><span>Personnel Atelier</span></div>
            <div class="legend-item"><div class="legend-color legend-charge"></div><span>Charg√© d'affaire</span></div>
            <div class="legend-item"><div class="legend-color legend-bureau"></div><span>Personnel Bureau</span></div>
            <div class="legend-item"><div class="legend-color vacation"></div><span>Cong√©s</span></div>
            <div class="legend-item"><div class="legend-color legend-arret"></div><span>Arr√™t de travail</span></div>
            <div class="legend-item"><div class="legend-color holiday"></div><span>Jour f√©ri√©</span></div>
        </div>
        <table class="planning-table" id="planningTable">
            <thead><tr id="tableHeader"></tr></thead>
            <tbody id="tableBody"></tbody>
        </table>
        <button class="btn btn-success add-personnel-btn no-print" onclick="addPersonnelRow()">+ Ajouter une ligne de personnel</button>
    </div>

    <div id="teamModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2 id="modalTitle"></h2><span class="close" onclick="closeModal()">&times;</span></div>
            <div class="form-group"><label>Nom du personnel</label><input type="text" id="personnelName" placeholder="Nom et pr√©nom"></div>
            <div class="form-group"><label class="checkbox-label"><input type="checkbox" id="stagiaire" style="width: auto;">Stagiaire/Alternant</label></div>
            <button class="btn btn-success" onclick="addPersonnel()">Ajouter</button>
            <div class="personnel-list" id="personnelList"></div>
        </div>
    </div>

    <div id="vacationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>Gestion des Cong√©s</h2><span class="close" onclick="closeVacationModal()">&times;</span></div>
            <div class="form-group"><label>Personnel</label><select id="vacationPersonnelSelect" class="day-select"></select></div>
            <div class="form-group"><label>Date de d√©but</label><input type="date" id="vacationStartDate"></div>
            <div class="form-group"><label>Date de fin</label><input type="date" id="vacationEndDate"></div>
            <div class="form-group"><label class="checkbox-label"><input type="checkbox" id="arretTravail">Arr√™t de travail</label></div>
            <button class="btn btn-success" onclick="addVacationPeriod()">Ajouter</button>
            <div class="personnel-list" id="vacationList"></div>
        </div>
    </div>

    <div id="workModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>D√©tails de l'affectation</h2><span class="close" onclick="closeWorkModal()">&times;</span></div>
            <div class="form-group"><label>Client</label><input type="text" id="clientName"></div>
            <div class="form-group"><label>Site/Affaire</label><input type="text" id="siteName"></div>
            <div class="form-group"><label>Appliquer √† :</label>
                <div class="checkbox-group">
                    <label class="checkbox-label"><input type="checkbox" id="applyMonday"> Lundi</label>
                    <label class="checkbox-label"><input type="checkbox" id="applyTuesday"> Mardi</label>
                    <label class="checkbox-label"><input type="checkbox" id="applyWednesday"> Mercredi</label>
                    <label class="checkbox-label"><input type="checkbox" id="applyThursday"> Jeudi</label>
                    <label class="checkbox-label"><input type="checkbox" id="applyFriday"> Vendredi</label>
                </div>
            </div>
            <button class="btn btn-success" onclick="saveWorkInfo()">Enregistrer</button>
            <div class="delete-options" id="deleteOptions" style="display:none;">
                <h4>Supprimer</h4>
                <button class="btn btn-danger" onclick="deleteCurrentDay()">Ce jour uniquement</button>
                <button class="btn btn-danger" onclick="deleteAllSelectedDays()">Tous les jours s√©lectionn√©s</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="planning.js"></script>
</body>
</html>
